<html>
<head>
<title>UserList.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,128); font-weight: bold; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(128,128,128); font-style: italic; }
.s3 { color: rgb(128,128,128); font-weight: bold; font-style: italic; }
.s4 { color: rgb(0,128,0); font-weight: bold; }
.s5 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
UserList.java</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">package </span><span class="s1">model.registration; 
 
</span><span class="s0">import </span><span class="s1">lib.password_hashing.PasswordStorage; 
</span><span class="s0">import </span><span class="s1">model.Users.Account; 
</span><span class="s0">import </span><span class="s1">model.Users.Admin; 
</span><span class="s0">import </span><span class="s1">model.Users.AuthLevel; 
</span><span class="s0">import </span><span class="s1">model.log.LogList; 
</span><span class="s0">import </span><span class="s1">db.DB; 
 
</span><span class="s0">import </span><span class="s1">java.util.*; 
 
</span><span class="s2">/** 
 * Created by Alexandra on 9/28/2016. 
 * A class that holds a map of all users in the system and their respective 
 * Accounts. Oversees creation of new users and adds them to the list, permits 
 * updates, and performs existence checks of Accounts. 
 */</span><span class="s1"> 
</span><span class="s0">public class </span><span class="s1">UserList { 
    </span><span class="s0">private static final </span><span class="s1">Map&lt;String, Account&gt; userMap = </span><span class="s0">new </span><span class="s1">HashMap&lt;&gt;(); 
 
    </span><span class="s2">/** 
     * Gets the set of users 
     * </span><span class="s3">@return </span><span class="s2">a Set containing usernames as Strings 
     */</span><span class="s1"> 
    </span><span class="s0">public static </span><span class="s1">Collection&lt;String&gt; getUserList() { 
        </span><span class="s0">return </span><span class="s1">userMap.keySet(); 
    } 
 
    </span><span class="s2">/** 
     * Gets the Account object associated with the given userid 
     * </span><span class="s3">@param </span><span class="s2">userid the userid of the desired account 
     * </span><span class="s3">@return </span><span class="s2">the Account associated with the userid or null if none exists 
     */</span><span class="s1"> 
    </span><span class="s0">public static </span><span class="s1">Account getUserAccount(String userid) { 
        </span><span class="s0">return </span><span class="s1">userMap.get(userid); 
    } 
 
    </span><span class="s2">/** 
     * Expands User Map from a given List of Accounts 
     * </span><span class="s3">@param </span><span class="s2">accounts List of Accounts that need to be added to the userMap 
     */</span><span class="s1"> 
    </span><span class="s0">public static void </span><span class="s1">mapAllAccounts(List&lt;Account&gt; accounts) { 
        </span><span class="s0">if </span><span class="s1">(accounts != </span><span class="s0">null</span><span class="s1">) { 
            </span><span class="s0">for </span><span class="s1">(Account acc : accounts) { 
                </span><span class="s0">if </span><span class="s1">(!userMap.containsValue(acc)) { 
                    System.out.println(acc.getName()); 
                    userMap.put(acc.getEmail(), acc); 
                } 
            } 
        } 
    } 
    </span><span class="s2">/** 
     * If input is valid, makes a new Account and updates Authentication and 
     * UserList's maps. 
     * </span><span class="s3">@param </span><span class="s2">firstName the user's first name 
     * </span><span class="s3">@param </span><span class="s2">lastName the user's last name 
     * </span><span class="s3">@param </span><span class="s2">userid the user's email 
     * </span><span class="s3">@param </span><span class="s2">pass1 the user's password 
     * </span><span class="s3">@param </span><span class="s2">pass2 confirm password 
     * </span><span class="s3">@param </span><span class="s2">auth the user's specified AuthLevel 
     * </span><span class="s3">@return </span><span class="s2">the Account added to the userMap, or null if the Account 
     * could not be added 
     */</span><span class="s1"> 
    </span><span class="s0">public static </span><span class="s1">Account makeNewUser(String firstName, String lastName, 
                                      String userid, String pass1, 
                                      String pass2, AuthLevel auth) 
            </span><span class="s0">throws </span><span class="s1">PasswordStorage.CannotPerformOperationException { 
        Account account = UserFactory.makeAccount(firstName, lastName, 
                userid, auth); 
        </span><span class="s0">if </span><span class="s1">(userMap.containsKey(userid) 
                || Authentication.verifySubject(userid)) { 
            </span><span class="s0">return null</span><span class="s1">; 
        } 
        </span><span class="s0">if </span><span class="s1">(Authentication.addNewAccount(userid, pass1, pass2)) { 
            userMap.put(userid, account); 
            System.out.println(account.getName()); 
            </span><span class="s0">return </span><span class="s1">account; 
        } 
        </span><span class="s0">return null</span><span class="s1">; 
    } 
 
    </span><span class="s2">/** 
     * Given a new userid, updates the map, deleting the old entry 
     * </span><span class="s3">@param </span><span class="s2">oldEmail the user's old email 
     * </span><span class="s3">@param </span><span class="s2">newEmail the user's new email 
     * </span><span class="s3">@throws </span><span class="s2">java.util.NoSuchElementException if no user is associated 
     * with the given oldEmail 
     * </span><span class="s3">@return </span><span class="s2">true iff the map was updated, false otherwise 
     */</span><span class="s1"> 
    </span><span class="s0">public static boolean </span><span class="s1">updateMap(String oldEmail, String newEmail) 
            </span><span class="s0">throws </span><span class="s1">PasswordStorage.CannotPerformOperationException { 
        Account account = userMap.remove(oldEmail); 
        </span><span class="s0">if </span><span class="s1">(account == </span><span class="s0">null</span><span class="s1">) { 
            </span><span class="s0">throw new </span><span class="s1">java.util.NoSuchElementException(</span><span class="s4">&quot;No account is&quot;</span><span class="s1"> 
                    + </span><span class="s4">&quot;associated with the userid &quot; </span><span class="s1">+ oldEmail); 
        } 
        account.setEmail(newEmail); 
        userMap.put(newEmail, account); 
        </span><span class="s0">return </span><span class="s1">Authentication.updateEmail(oldEmail, newEmail); 
    } 
 
    </span><span class="s2">// For methods such as deleteAccount, banAccount, and unblockAccount,</span><span class="s1"> 
    </span><span class="s2">// we chose to adhere to previous design choice in that a successful</span><span class="s1"> 
    </span><span class="s2">// action returns true, otherwise false. For these methods, these actions</span><span class="s1"> 
    </span><span class="s2">// should always be true.</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Deletes the userid-Account mapping associated with the given userid 
     * Precondition: Admin is logged into the system 
     * </span><span class="s3">@param </span><span class="s2">admin the Admin deleting an Account 
     * </span><span class="s3">@param </span><span class="s2">userid the userid of the Account to be deleted 
     * </span><span class="s3">@throws </span><span class="s2">java.util.NoSuchElementException if no user is associated 
     * with the given userid 
     * </span><span class="s3">@return </span><span class="s2">true iff the Account was successfully deleted 
     */</span><span class="s1"> 
    </span><span class="s0">public static boolean </span><span class="s1">deleteAccount(Admin admin, String userid) { 
        Account deleted = userMap.remove(userid); 
        DB.deleteAccount(deleted); 
        </span><span class="s0">if </span><span class="s1">((deleted == </span><span class="s0">null</span><span class="s1">) || !Authentication.deleteAccount(userid)) { 
            </span><span class="s0">throw new </span><span class="s1">java.util.NoSuchElementException(</span><span class="s4">&quot;No account is&quot;</span><span class="s1"> 
                    + </span><span class="s4">&quot;associated with the userid &quot; </span><span class="s1">+ userid); 
        } 
        LogList.makeDeletedAccountEntry(admin, userid); 
        </span><span class="s0">return true</span><span class="s1">; 
    } 
 
    </span><span class="s2">/** 
     * Bans the Account associated with the given userid 
     * Precondition: Admin is logged into the system 
     * </span><span class="s3">@param </span><span class="s2">admin the Admin banning an Account 
     * </span><span class="s3">@param </span><span class="s2">userid the userid of the Account to be banned 
     * </span><span class="s3">@throws </span><span class="s2">java.util.NoSuchElementException if no user is associated 
     * with the given userid 
     * </span><span class="s3">@return </span><span class="s2">true iff the Account was successfully deleted 
     */</span><span class="s1"> 
    </span><span class="s0">public static boolean </span><span class="s1">banAccount(Admin admin, String userid) { 
        Account account = userMap.get(userid); 
        </span><span class="s0">if </span><span class="s1">(account == </span><span class="s0">null</span><span class="s1">) { 
            </span><span class="s0">throw new </span><span class="s1">java.util.NoSuchElementException(</span><span class="s4">&quot;No account is&quot;</span><span class="s1"> 
                    + </span><span class="s4">&quot;associated with the userid &quot; </span><span class="s1">+ userid); 
        } 
        account.setIsBanned(); 
        DB.ban(userid); 
        LogList.makeBannedAccountEntry(admin, userid); 
        </span><span class="s0">return true</span><span class="s1">; 
    } 
 
    </span><span class="s2">/** 
     * Unblocks the Account associated with the given userid 
     * Precondition: Admin is logged into the system 
     * </span><span class="s3">@param </span><span class="s2">admin the Admin banning an Account 
     * </span><span class="s3">@param </span><span class="s2">userid the userid of the Account to be unblocked 
     * </span><span class="s3">@throws </span><span class="s2">java.util.NoSuchElementException if no user is associated 
     * with the given userid 
     * </span><span class="s3">@return </span><span class="s2">true iff the Account was successfully unblocked 
     */</span><span class="s1"> 
    </span><span class="s0">public static boolean </span><span class="s1">unblockAccount(Admin admin, String userid) { 
        Account account = userMap.get(userid); 
        </span><span class="s0">if </span><span class="s1">(account == </span><span class="s0">null</span><span class="s1">) { 
            </span><span class="s0">throw new </span><span class="s1">java.util.NoSuchElementException(</span><span class="s4">&quot;No account is +&quot;</span><span class="s1"> 
                    + </span><span class="s4">&quot;associated with the userid &quot; </span><span class="s1">+ userid); 
        } 
        account.setBlocked(</span><span class="s0">false</span><span class="s1">); 
        DB.unblock(userid); 
        LogList.makeUnblockAccountEntry(admin, userid); 
        </span><span class="s0">return true</span><span class="s1">; 
    } 
 
    </span><span class="s2">/** 
     * Checks if the given userid exists in the userMap 
     * </span><span class="s3">@param </span><span class="s2">userid the userid to check 
     * </span><span class="s3">@return </span><span class="s2">true iff userMap contains the userid 
     */</span><span class="s1"> 
    </span><span class="s0">public static boolean </span><span class="s1">containsUserID(String userid) { 
        </span><span class="s0">return </span><span class="s1">userMap.containsKey(userid); 
    } 
 
    </span><span class="s2">/** 
     * Used for creating the users gathered from a saved file 
     * </span><span class="s3">@param </span><span class="s2">users the users being added 
     * </span><span class="s3">@param </span><span class="s2">pass the passwords for the users being added 
     */</span><span class="s1"> 
 
    </span><span class="s0">public static void </span><span class="s1">addAccounts(List&lt;Account&gt; users, 
                                   List&lt;CharSequence&gt; pass) 
            </span><span class="s0">throws </span><span class="s1">PasswordStorage.CannotPerformOperationException { 
        </span><span class="s0">if </span><span class="s1">(users.size() == pass.size()) { 
            </span><span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s1">; i &lt; users.size(); i++) { 
                Authentication.addNewAccount(users.get(i).getEmail(), 
                        pass.get(i).toString(), pass.get(i).toString()); 
                userMap.put(users.get(i).getEmail(), users.get(i)); 
            } 
        } 
    } 
} 
</span></pre>
</body>
</html>