<html>
<head>
<title>test.rb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,0); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
test.rb</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">require_relative '../PasswordStorage.rb' 
 
module Test 
 
  def self.runTests 
    truncatedHashTest() 
    testHashFunctionChecking() 
    testMoreThings() 
  end 
 
  def self.truncatedHashTest 
    userString = &quot;test_password&quot; 
    hash = PasswordStorage.createHash( userString ) 
    badHashLength = hash.length 
 
    loop do 
      badHashLength -= 1 
      badHash = hash[0...badHashLength] 
 
      raised = false 
      begin 
        PasswordStorage.verifyPassword( userString, badHash ) 
      rescue InvalidHashError 
        raised = true 
      end 
 
      if !raised 
        puts &quot;Truncated hash test: FAIL (At hash length of #{badHashLength})&quot; 
        exit(1) 
      end 
     break if badHash[ badHashLength - 3, 1] == ':' 
    end 
 
    puts &quot;Truncated hash test: pass&quot; 
  end 
 
  def self.testHashFunctionChecking 
    hash = PasswordStorage.createHash(&quot;foobar&quot;) 
    hash = hash.sub(&quot;sha1:&quot;, &quot;sha256:&quot;) 
    raised = false 
    begin 
      PasswordStorage.verifyPassword(&quot;foobar&quot;, hash) 
    rescue CannotPerformOperationException 
      raised = true 
    end 
 
    if raised 
      puts &quot;Algorithm swap: pass&quot; 
    else 
      puts &quot;Algorithm swap: FAIL&quot; 
      exit(1) 
    end 
  end 
 
  def self.testMoreThings 
    correctPassword = 'aaaaaaaaaa' 
    wrongPassword = 'aaaaaaaaab' 
    hash = PasswordStorage.createHash(correctPassword) 
 
    assert( PasswordStorage.verifyPassword( correctPassword, hash ) == true, &quot;correct password&quot; ) 
    assert( PasswordStorage.verifyPassword( wrongPassword, hash ) == false, &quot;wrong password&quot; ) 
 
    h1 = hash.split( PasswordStorage::SECTION_DELIMITER ) 
    h2 = PasswordStorage.createHash( correctPassword ).split( PasswordStorage::SECTION_DELIMITER ) 
    assert( h1[PasswordStorage::HASH_PBKDF2_INDEX] != h2[PasswordStorage::HASH_PBKDF2_INDEX], &quot;different hash&quot; ) 
    assert( h1[PasswordStorage::HASH_SALT_INDEX] != h2[PasswordStorage::HASH_SALT_INDEX], &quot;different salt&quot; ) 
 
    puts &quot;More things: pass&quot; 
  rescue RuntimeError =&gt; e 
    puts &quot;More things: fail&quot; 
    raise e 
  end 
 
  def self.assert( truth, msg ) 
    if truth 
      # do nothing 
    else 
      raise RuntimeError.new(&quot;FAILURE: [#{msg}]&quot;) 
    end 
  end 
 
end 
 
Test.runTests() 
</span></pre>
</body>
</html>