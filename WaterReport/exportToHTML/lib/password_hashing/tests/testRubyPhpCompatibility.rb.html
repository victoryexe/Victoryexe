<html>
<head>
<title>testRubyPhpCompatibility.rb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,0); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
testRubyPhpCompatibility.rb</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">require_relative '../PasswordStorage.rb' 
 
module TestRubyAndPhpCompatiblity 
  def self.testRubyHash() 
    userString = &quot;test_password&quot; 
    rubyHash = PasswordStorage.createHash( userString ) 
 
    result = system(*[&quot;php&quot;, &quot;./tests/phpVerify.php&quot;, userString, rubyHash]) 
    # System returns true if zero, false if non-zero exit status. 
    if result 
      puts 'Ruby hash validating in PHP: pass' 
    else 
      puts 'Ruby hash validating in PHP: FAIL' 
      exit(1) 
    end 
 
    # Test an incorrect password too 
    badPassword = &quot;badpw&quot; 
    result = system(*[&quot;php&quot;, &quot;./tests/phpVerify.php&quot;, badPassword, rubyHash]) 
    if result == false 
      puts &quot;Ruby hash validating bad password in PHP: pass&quot; 
    else 
      puts &quot;Ruby hash validating bad password in PHP: FAIL&quot; 
      exit(1) 
    end 
  end 
 
  def self.testPHPHash() 
    testData = `php ./tests/phpHashMaker.php` 
    testData = testData.split(' ') 
 
    testPw = testData[1] 
    testHash = testData[2] 
 
    if testPw.length != testData[0].to_i 
      puts &quot;Unicode test is invalid&quot; 
      exit(1) 
    end 
 
    if PasswordStorage.verifyPassword(testPw, testHash) 
      puts &quot;PHP hash validating in Ruby: pass&quot; 
    else 
      puts &quot;PHP hash validating in Ruby: FAIL&quot; 
      exit(1) 
    end 
 
    badPw = &quot;baddd&quot; 
 
    if !PasswordStorage.verifyPassword(badPw, testHash) 
      puts &quot;PHP hash validating bad password in Ruby: pass&quot; 
    else 
      puts &quot;PHP hash validating bad password in Ruby: FAIL&quot; 
      exit(1) 
    end 
  end 
end 
 
TestRubyAndPhpCompatiblity.testPHPHash() 
TestRubyAndPhpCompatiblity.testRubyHash() 
</span></pre>
</body>
</html>